# Инструкция по программированию ККТ Пирит2Ф
## Описание протокола.
### 1.1 Формат протокола передачи команд
Связь контрольно-кассовой техники (далее ККТ) с компьютером осуществляется по интерфейсу RS232 или USB в режиме виртуального COM порта. Параметры COM порта по умолчанию - 57600,n,8,1. 
Взаимодействие между кассовой программой (далее КП) инициируется со стороны КП: КП посылает командное сообщение (команду), а ККТ всегда посылает ответное сообщение (ответ). Взаимодействие КП с ККТ может осуществляться в двух режимах: синхронном и асинхронном. В синхронном режиме компьютер посылает команду и ждет ответ на него. После получения ответа компьютер посылает следующую команду. Взаимодействие в синхронном режиме может осуществляться без использования линий аппаратного квитирования (DTR/DSR, CTS/RTS). В асинхронном режиме компьютер посылает командные сообщения и принимает ответные сообщения в произвольной последовательности. Взаимодействие в этом режиме должно осуществляться с использованием линий аппаратного квитирования CTS/RTS.
Взаимодействие ККТ с техническими средствами ОФД (далее ТС ОФД) осуществляется по протоколу TCP/IP. Инициатором отправки фискальных данных в ТС ОФД всегда выступает ККТ. Взаимодействие ККТ с ТС ОФД подробно изложено в описании протокола взаимодействия между ККТ и информационной (автоматизированной) системой оператора  фискальных данных, введенной в действие ФНС России 01.04.2016 
 
Пакет команды со стороны КП
STX
Пароль связи
ID пакета
Код команды
Данные
ETX
CRC
 
Пакет ответа со стороны ККТ
STX
ID пакета
Код команды
Код ошибки
Данные
ETX
CRC
 
 
STX- байт начала пакета (0x02).
ETX-  байт окончания пакета (0x03).
CRC- контрольная сумма пакета. Контрольная сумма подсчитывается по алгоритму: выполнение операции XOR для всех байт блока, включая ETX, но исключая STX. Данные контрольной суммы занимают два байта и являются символьным представлением числа в шестнадцатеричной системе исчисления.
ID пакета- идентификатор пакета. Произвольный байт, имеющий код в промежутке между 0x20 и 0xF0. ID пакета в ответе на команду, всегда совпадает с ID пакета команды. Может использоваться для синхронизации пакета команды и ответа на нее в условиях многозадачности в приложении или в асинхронном режиме.
Пароль связи- четырехбайтовый пароль, предназначенный для ограничения возможности несанкционированной работы с ККТ. Пароль по умолчанию - ”PIRI”.  
Код команды- два байта, представляющие собой код команды в шестнадцатеричном
