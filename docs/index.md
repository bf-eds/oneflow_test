# Описание команд ККТ
## Запрос флагов статуса ККТ (0x00)
### Описание
Команда возвращает статус фатального состояния ККТ, статус текущих флагов ККТ и статус документа.

### Входные параметры
Нет

### Ответные параметры
 * (Целое число) Статус фатального состояния ККТ  
 * (Целое число) Статус текущих флагов ККТ  
 * (Целое число) Статус документа

### Дополнительная информация

**Статус фатального состояния ККТ**

Номер бита | Пояснение
--- | ---
0 | Неверная контрольная сумма NVR
1 | Неверная контрольная сумма в конфигурации
2 | Зарезервировано
3 | Зарезервировано
4 | Зарезервировано
5 | ККТ не авторизовано
6 | Фатальная ошибка ФН
7 | Зарезервировано

   *При установке любого бита статуса фатального состояния блокируются все функции ККТ, за исключением битов 6 и 7, при установке которых доступны команды закрытия смены.*

**Статус текущих флагов ККТ**

Номер бита | Пояснение
--- | ---
0 | Не была вызвана функция “Начало работы”
1 | Нефискальный режим
2 | Смена открыта
3 | Смена больше 24 часов
4 | Архив ФН закрыт
5 | ФН не зарегистрирован
6 | Зарезервировано
7 | Зарезервировано
8 | Не было завершено закрытие смены, необходимо повторить операцию

**Статус документа**

Номер бита | Пояснение
--- | ---
 | **0..3 бит Тип текущего открытого документа**
0 | документ закрыт  
1 | сервисный документ  
2 | чек на продажу (приход)  
3 | чек на возврат (возврат прихода)  
4 | внесение в кассу  
5 | инкассация  
6 | чек на покупку (расход)  
7 | чек на возврат покупки (возврат расхода)  
 | **4..7 бит Состояние документа**
0 | документ закрыт  
1 | устанавливается после команды "открыть документ". Для типов документа 2 и 3 можно добавлять товарные позиции  
2 | Устанавливается после первой команды "Подытог"  
3 | Устанавливается после второй команды "Подытог" или после начала команды «Оплата». Можно только производить оплату различными типами платежных средств  
4 | Расчет завершен - требуется закрыть документ  
8 | Команда закрытия документа была дана в ФН, но документ не был завершен. Аннулирование документа невозможно  

## Запрос сменных счетчиков и регистров (0x01)
### Описание
Эта команда позволяет получать различные значения сменных счетчиков и регистров ККТ.

### Входные параметры
 * (Целое число) Номер запроса 

### Ответные параметры
 * (Целое число) Номер запроса
 * Возвращаемые данные. Тип и количество возвращаемых данных зависит от номера запроса

Номер запроса (DEC) | Наименование Запроса | Формат возвращаемых данных | Комментарии
--- | --- | --- | ---
1 | Вернуть номер текущей смены | Целое число | 
2 | Вернуть номер следующего чека | Целое число | Возвращается правильный номера чека только при автоматической нумерации чеков средствами самой ККТ.
3 | Вернуть суммы продаж по типам платежа | Дробное число \* 16 | Возвращается 16 значений – по максимально возможному количеству типов платежей
4 | Вернуть количество оплат по продажам | Целое число \* 16 |
5 | Вернуть суммы возвратов по типам платежа | Дробное число \* 16 |
6 | Вернуть количество оплат по возвратам | Целое число \* 16 | 
7 | Вернуть количество оформленных чеков по типам операций | Целое число \*6 | Возвращается 6 значений – количество чеков продажи, возврата, аннулированных, отложенных, чеков внесения и изъятия
8 | Вернуть суммы по оформленным чекам | Дробное число \* 4 | Возвращается 4 значения – суммы по аннулированным и отложенным чекам, чекам внесения и изъятия
9 | Вернуть суммы по скидкам | Дробное число \* 4 | Возвращает 4 значения - сумма скидок по продажам, 0, сумма скидок по возвратам, 0.
10 | Вернуть суммы налогов по продажам | Дробное число \* 6 |
11 | Вернуть суммы налогов по возвратам | Дробное число \*6 | 
12 | Вернуть данные по последнему X отчету или отчету о закрытии смены | Строка, Целое число, Дробное число, Целое число, Дробное число, Целое число, Дробное число, Целое число, Дробное число, Целое число, Дробное число, Целое число, Дробное число | текущий операционный счетчик, номер документа, сумма в кассе, кол-во продаж (кол-во приходов), сумма продаж (сумма приходов), кол-во возвратов (возвратов прихода), сумма возвратов (возвратов прихода), количество аннулированных, сумма аннулированных, количество внесений, сумма внесений, количество изъятий, сумма изъятий
13 | Вернуть суммы по секциям/отделам по продажам | Дробное число \* 16 | Возвращается 16 значений – по максимально возможному количеству секций/отделов
14 | Вернуть суммы по секциям/отделам по возвратам | Дробное число \* 16 | Возвращается 16 значений – по максимально возможному количеству секций/отделов
15 | Вернуть количество оформленных чеков по типам операций | Целое число, Целое число | кол-во чеков покупок (расходов), кол-во чеков возвратов покупок (возвратов расхода)
16 | Вернуть суммы покупок по типам платежа | Дробное число \* 16 | Возвращается 16 значений – по максимально возможному количеству типов платежей.
17 | Вернуть суммы возвратов покупок по типам платежа | Дробное число \* 16 |Возвращается 16 значений – по максимально возможному количеству типов платежей.
18 | Вернуть данные по коррекциям | Целое число, Дробное число \* 2 | Количество коррекций, Суммы коррекций наличными и безналичными


##  (0x02)
### Описание
Эта команда позволяет получать разнообразную информацию о ККТ.

### Входные параметры
(Целое число) Номер запроса.
### Ответные параметры
 * (Целое число) Номер запроса
 * Возвращаемые данные. Тип и количество возвращаемых данных зависит от номера запроса

Номер запроса (DEC) | Наименование Запроса | Формат возвращаемых данных | Комментарии
--- | --- | --- | ---
1 | Вернуть заводской номер ККТ | Строка | 
2 | Вернуть идентификатор прошивки | Целое число | 
3 | Вернуть ИНН | Строка | 
4 | Вернуть регистрационный номер ККТ | Строка | 
5 | Вернуть дату и время последней фискальной операции | Дата, Время | 
6 | Вернуть дату регистрации / перерегистрации | Дата | 
7 | Вернуть сумму наличных в денежном ящике | Дробное число
8 | Вернуть номер следующего документа | Целое число
9 | Вернуть номер смены регистрации | Целое число
10 | Вернуть номер следующего X отчета | Целое число
11 | Вернуть текущий операционный счетчик | Строка
12 | Вернуть нарастающий итог | Дробное число, Дробное число, Дробное число, Дробное число | Продажа (приход), Возврат (возврат прихода), Покупка (расход), Возврат покупки (возврат расхода) |
14 | Вернуть дату окончания временного ресурса ФН | Дата |
15 | Вернуть тип прошивки | Целое число | 0- стандартная прошивка, 1- отладочный комплект
16 | Вернуть размер бумаги текущего дизайна | Целое число | 0- 80мм, 1- 57мм
17 | Вернуть дату и время открытия смены | Дата, Время |
21 | Вернуть модель устройства | Целое число |
23 | Вернуть систему налого- обложения и режим работы и ФН | Целое число, Целое число, Целое число | Система налогообложения, Режим работы, Признак установки принтера в автомате
24 | Вернуть максимальное количество дополнительных строк в начале и в конце чека | Целое число, Целое число | Максимальное количество строк в начале чека, Максимальное количество строк в конце чека
70 | Вернуть рабочий идентификатор прошивки | Строка |
 
